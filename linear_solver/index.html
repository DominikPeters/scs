<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Linear System Solver &mdash; SCS 3.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/scs_theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="BLAS and LAPACK" href="../blas_lapack/index.html" />
    <link rel="prev" title="R" href="../install/r.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/scs_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../algorithm/index.html">Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Install</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Linear System Solver</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#available-linear-solvers">Available linear solvers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#direct-method">Direct method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#indirect-method">Indirect method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gpu-indirect-method">GPU indirect method</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#implementing-a-new-linear-solver">Implementing a new linear solver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../blas_lapack/index.html">BLAS and LAPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help/index.html">Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citing/index.html">Citing SCS</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SCS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Linear System Solver</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/linear_solver/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="linear-system-solver">
<span id="linear-solver"></span><h1>Linear System Solver<a class="headerlink" href="#linear-system-solver" title="Permalink to this headline"></a></h1>
<p>At each iteration SCS must compute the following</p>
<div class="math notranslate nohighlight">
\[z = p^k - r \tau,\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
p^k &amp;= (R + M)^{-1} R \mu^k \\
r   &amp;= (R + M)^{-1} q
\end{align}\end{split}\]</div>
<p>the presence of the diagonal <span class="math notranslate nohighlight">\(R\)</span> matrices is explained in
<a class="reference internal" href="../algorithm/scale.html#scaling"><span class="std std-ref">Non-identity DR Scaling</span></a> (<span class="math notranslate nohighlight">\(R\)</span> does <em>not</em> appear before <span class="math notranslate nohighlight">\(q\)</span> in the second
expression above).  Now consider <span class="math notranslate nohighlight">\(r = (R + M)^{-1} q\)</span> and recall</p>
<div class="math notranslate nohighlight">
\[\begin{split}M = \begin{bmatrix}
      P  &amp;  A^\top \\
      -A &amp;  0   \\
    \end{bmatrix}\end{split}\]</div>
<p>Specifically, we want to solve</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix}
r_x \\
r_y
\end{bmatrix}
=
\begin{bmatrix}
\rho_x I + P  &amp;  A^\top \\
-A &amp;  \mathrm{diag}(\rho_y)   \\
\end{bmatrix}
\begin{bmatrix}
q_x \\
q_y
\end{bmatrix}\end{split}\]</div>
<p>which is quasidefinite if we negate the bottom row:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix}
r_x \\
r_y
\end{bmatrix}
=
\begin{bmatrix}
\rho_x I + P  &amp;  A^\top \\
A &amp;  -\mathrm{diag}(\rho_y)   \\
\end{bmatrix}
\begin{bmatrix}
q_x \\
-q_y
\end{bmatrix}\end{split}\]</div>
<p>A direct method factorizes the above matrix.
An indirect method can solve via:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
(\rho_x I + P + A^\top \mathrm{diag}(\rho_y)^{-1} A) r_x &amp; = q_x - A^\top \mathrm{diag}(\rho_y)^{-1} q_y \\
                          r_y &amp; = \mathrm{diag}(\rho_y)^{-1}(A z_x + q_y).
\end{align}\end{split}\]</div>
<div class="section" id="available-linear-solvers">
<h2>Available linear solvers<a class="headerlink" href="#available-linear-solvers" title="Permalink to this headline"></a></h2>
<p>Each of the below linear solvers is included in their own binary. If linking
against SCS directly, then to switch between them you must compile and link
against the right binary. If using SCS via one of the interfaces then you can
choose between the different linear solvers using the appropriate settings.</p>
<div class="section" id="direct-method">
<span id="direct"></span><h3>Direct method<a class="headerlink" href="#direct-method" title="Permalink to this headline"></a></h3>
<p>The direct method is the default linear system solver in SCS and factorizes the
above matrix using a sparse permuted LDL factorization. Then it solves the
linear system at each iteration using the cached factors.  It relies on the
external <a class="reference external" href="https://github.com/DrTimothyAldenDavis/SuiteSparse">AMD</a> and <a class="reference external" href="https://github.com/oxfordcontrol/qdldl">QDLDL</a> packages.</p>
</div>
<div class="section" id="indirect-method">
<span id="indirect"></span><h3>Indirect method<a class="headerlink" href="#indirect-method" title="Permalink to this headline"></a></h3>
<p>The indirect method solves the above linear system approximately with a
‘matrix-free’ method. To do this it first reduces the system as described above
then solves the positive definite system using using <a class="reference external" href="https://en.wikipedia.org/wiki/Conjugate_gradient_method">conjugate gradients</a>.  Each iteration of
CG requires one multiply each of <span class="math notranslate nohighlight">\(P, A, A^\top\)</span>.  The system is solved up
to some tolerance, which is tuned to ensure that the overall algorithm
converges. The tolerance decays with iteration <span class="math notranslate nohighlight">\(k\)</span> like
<span class="math notranslate nohighlight">\(O(1/k^\gamma)\)</span> where <span class="math notranslate nohighlight">\(\gamma &gt; 1\)</span> and is determined by the constant
<code class="code docutils literal notranslate"><span class="pre">CG_RATE</span></code> (defaults to <span class="math notranslate nohighlight">\(1.5\)</span>).</p>
<p>The indirect method has the advantage of not requiring an expensive
factorization but typically is slower on a per-iteration basis. In most cases
the factorization is relatively cheap so the direct method is the default,
however for very large problems the indirect solver can be faster.</p>
</div>
<div class="section" id="gpu-indirect-method">
<span id="gpu-indirect"></span><h3>GPU indirect method<a class="headerlink" href="#gpu-indirect-method" title="Permalink to this headline"></a></h3>
<p>The above linear solvers all run on CPU. We also have support for a GPU version
of the indirect solver, where the multiplies are all performed on the GPU.</p>
</div>
</div>
<div class="section" id="implementing-a-new-linear-solver">
<span id="new-linear-solver"></span><h2>Implementing a new linear solver<a class="headerlink" href="#implementing-a-new-linear-solver" title="Permalink to this headline"></a></h2>
<p>In order to implement you own linear system solver, you need to implement the
struct <code class="code docutils literal notranslate"><span class="pre">ScsLinSysWork</span></code> that contains the workspace your solver requires,
and implement the functions in <code class="code docutils literal notranslate"><span class="pre">include/linsys.h</span></code>:</p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv421scs_init_lin_sys_workPK9ScsMatrixPK9ScsMatrixP9scs_float9scs_float">
<span id="_CPPv321scs_init_lin_sys_workPK9ScsMatrixPK9ScsMatrixP9scs_float9scs_float"></span><span id="_CPPv221scs_init_lin_sys_workPK9ScsMatrixPK9ScsMatrixP9scs_float9scs_float"></span><span id="scs_init_lin_sys_work__ScsMatrixCP.ScsMatrixCP.scs_floatP.scs_float"></span><span class="target" id="linsys_8h_1a4a172ae80bee4847011f913e21e4ab4c"></span><span class="n"><span class="pre">ScsLinSysWork</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">scs_init_lin_sys_work</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="../api/c.html#_CPPv49ScsMatrix" title="ScsMatrix"><span class="n"><span class="pre">ScsMatrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">A</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="../api/c.html#_CPPv49ScsMatrix" title="ScsMatrix"><span class="n"><span class="pre">ScsMatrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">P</span></span>, <span class="n"><span class="pre">scs_float</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">rho_y_vec</span></span>, <span class="n"><span class="pre">scs_float</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">rho_x</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv421scs_init_lin_sys_workPK9ScsMatrixPK9ScsMatrixP9scs_float9scs_float" title="Permalink to this definition"></a><br /></dt>
<dd><p>Initialize ScsLinSysWork structure and perform any necessary preprocessing</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>A</strong> – A data matrix </p></li>
<li><p><strong>P</strong> – P data matrix </p></li>
<li><p><strong>rho_y_vec</strong> – R_y diagonal entries </p></li>
<li><p><strong>rho_x</strong> – rho_x float </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Linear system solver workspace </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv421scs_free_lin_sys_workP13ScsLinSysWork">
<span id="_CPPv321scs_free_lin_sys_workP13ScsLinSysWork"></span><span id="_CPPv221scs_free_lin_sys_workP13ScsLinSysWork"></span><span id="scs_free_lin_sys_work__ScsLinSysWorkP"></span><span class="target" id="linsys_8h_1a5ae24bcf8738840e3ddedf42fc451a26"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">scs_free_lin_sys_work</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">ScsLinSysWork</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv421scs_free_lin_sys_workP13ScsLinSysWork" title="Permalink to this definition"></a><br /></dt>
<dd><p>Frees ScsLinSysWork structure and allocated memory in ScsLinSysWork</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>w</strong> – Linear system private workspace </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv417scs_solve_lin_sysP13ScsLinSysWorkP9scs_floatPK9scs_float9scs_float">
<span id="_CPPv317scs_solve_lin_sysP13ScsLinSysWorkP9scs_floatPK9scs_float9scs_float"></span><span id="_CPPv217scs_solve_lin_sysP13ScsLinSysWorkP9scs_floatPK9scs_float9scs_float"></span><span id="scs_solve_lin_sys__ScsLinSysWorkP.scs_floatP.scs_floatCP.scs_float"></span><span class="target" id="linsys_8h_1a24229ab88459885462fcc7fa6759467f"></span><span class="n"><span class="pre">scs_int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">scs_solve_lin_sys</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">ScsLinSysWork</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">w</span></span>, <span class="n"><span class="pre">scs_float</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">b</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">scs_float</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">s</span></span>, <span class="n"><span class="pre">scs_float</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">tol</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv417scs_solve_lin_sysP13ScsLinSysWorkP9scs_floatPK9scs_float9scs_float" title="Permalink to this definition"></a><br /></dt>
<dd><p>Solves the linear system required by SCS at each iteration: <div class="math notranslate nohighlight">
\[\begin{split} \begin{bmatrix} (\rho_x I + P) &amp; A^\top \\ A &amp; -\mathrm{diag}(\rho_y) \\ \end{bmatrix} x = b \end{split}\]</div>
</p>
<p>for x, result stored result in b</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>w</strong> – Linear system private workspace </p></li>
<li><p><strong>b</strong> – Right hand side, should contain solution at the end </p></li>
<li><p><strong>s</strong> – Contains optional warm-start </p></li>
<li><p><strong>tol</strong> – Tolerance required for the system solve </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>status &lt; 0 indicates failure </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv428scs_update_lin_sys_rho_y_vecP13ScsLinSysWorkP9scs_float">
<span id="_CPPv328scs_update_lin_sys_rho_y_vecP13ScsLinSysWorkP9scs_float"></span><span id="_CPPv228scs_update_lin_sys_rho_y_vecP13ScsLinSysWorkP9scs_float"></span><span id="scs_update_lin_sys_rho_y_vec__ScsLinSysWorkP.scs_floatP"></span><span class="target" id="linsys_8h_1a0483a2c31df6210efbfe16d40003fa40"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">scs_update_lin_sys_rho_y_vec</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">ScsLinSysWork</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">w</span></span>, <span class="n"><span class="pre">scs_float</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">rho_y_vec</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv428scs_update_lin_sys_rho_y_vecP13ScsLinSysWorkP9scs_float" title="Permalink to this definition"></a><br /></dt>
<dd><p>Update the linsys workspace when new rho_y_vec is updated</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>w</strong> – Linear system private workspace </p></li>
<li><p><strong>rho_y_vec</strong> – R_y diagonal entries </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv422scs_get_lin_sys_methodv">
<span id="_CPPv322scs_get_lin_sys_methodv"></span><span id="_CPPv222scs_get_lin_sys_methodv"></span><span id="scs_get_lin_sys_method__void"></span><span class="target" id="linsys_8h_1a916ae46bf2bd801b82f79272d411b851"></span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">scs_get_lin_sys_method</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv422scs_get_lin_sys_methodv" title="Permalink to this definition"></a><br /></dt>
<dd><p>Name of the linear solver. Can return null.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>name of method </p>
</dd>
</dl>
</dd></dl>

</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../install/r.html" class="btn btn-neutral float-left" title="R" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../blas_lapack/index.html" class="btn btn-neutral float-right" title="BLAS and LAPACK" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Brendan O&#39;Donoghue.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-203326834-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-203326834-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>