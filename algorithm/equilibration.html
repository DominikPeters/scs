
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data equilibration &#8212; SCS 3.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/scs_theme.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Non-identity DR Scaling" href="scale.html" />
    <link rel="prev" title="Algorithm" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="data-equilibration">
<span id="equilibration"></span><h1>Data equilibration<a class="headerlink" href="#data-equilibration" title="Permalink to this headline"></a></h1>
<p>Data scale has a large impact on the convergence of first-order algorithms like
SCS in practice. With that in mind SCS implements a heuristic data equilibration
(or normalization) scheme that attempts to whiten the data which is enabled by
the <code class="code docutils literal notranslate"><span class="pre">normalize</span></code> <a class="reference internal" href="../api/settings.html#settings"><span class="std std-ref">setting</span></a>.</p>
<p>At a high level the equilibration scheme (which is performed once, right at
the start of the solve) produces diagonal matrices <span class="math notranslate nohighlight">\(E \in
\mathbf{R}^n\)</span>, <span class="math notranslate nohighlight">\(D \in \mathbf{R}^m\)</span> and scalar <span class="math notranslate nohighlight">\(\sigma &gt; 0\)</span> that rescale
the data in-place, so that the tuple <span class="math notranslate nohighlight">\((P, A, b, c)\)</span> becomes
<span class="math notranslate nohighlight">\((\hat P, \hat A, \hat b, \hat c)\)</span> where</p>
<div class="math notranslate nohighlight">
\[\hat P = EPE,\quad  \hat A  = DAE,\quad  \hat c  = \sigma Ec,\quad  \hat b = \sigma Db\]</div>
<p>Essentially:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix}
\hat P &amp; \hat A^\top &amp; \hat c\\
\hat A &amp; 0 &amp; \hat b \\
\hat c^\top &amp; \hat b^\top &amp; 0
\end{bmatrix}
=
\begin{bmatrix}
E &amp; 0 &amp; 0 \\
0 &amp; D &amp; 0 \\
0 &amp; 0 &amp; \sigma
\end{bmatrix}
\begin{bmatrix}
P &amp; A^\top &amp; c\\
A &amp; 0 &amp; b \\
c^\top &amp; b^\top &amp; 0
\end{bmatrix}
\begin{bmatrix}
E &amp; 0 &amp; 0 \\
0 &amp; D &amp; 0 \\
0 &amp; 0 &amp; \sigma
\end{bmatrix}
=
\begin{bmatrix}
EPE &amp; EA^\top D &amp; \sigma Ec\\
DAE &amp; 0 &amp; \sigma Db \\
\sigma c^\top E &amp; \sigma b^\top D &amp; 0
\end{bmatrix}\end{split}\]</div>
<p>In other words <span class="math notranslate nohighlight">\(D\)</span> rescales the rows of <span class="math notranslate nohighlight">\(A, b\)</span> and <span class="math notranslate nohighlight">\(E\)</span>
rescales the columns of <span class="math notranslate nohighlight">\(A\)</span> and the rows / cols of <span class="math notranslate nohighlight">\(P, c\)</span>.
Equilibrating matrices is a classic problem in linear algebra, and SCS simply
implements <code class="code docutils literal notranslate"><span class="pre">NUM_RUIZ_PASSES</span></code> (default 25) steps of Ruiz equilibration
followed by <code class="code docutils literal notranslate"><span class="pre">NUM_L2_PASSES</span></code> (default 1) steps of <span class="math notranslate nohighlight">\(\ell_2\)</span>
equilibration on the matrix</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix}
P &amp; A^\top &amp; c\\
A &amp; 0 &amp; b \\
c^\top &amp; b^\top &amp; 0
\end{bmatrix}\end{split}\]</div>
<p>The main complication of the equilibration is that <span class="math notranslate nohighlight">\(D\)</span> has to maintain
cone memberships, ie, it needs to satisfy for each sub-cone <span class="math notranslate nohighlight">\(\mathcal{K}\)</span></p>
<div class="math notranslate nohighlight">
\[s \in \mathcal{K} \Leftrightarrow D_{\mathcal{K}} s \in \mathcal{K}\]</div>
<p>To do this we restrict <span class="math notranslate nohighlight">\(D_\mathcal{K} = d_\mathcal{K} I_\mathcal{K}\)</span>, ie,
<span class="math notranslate nohighlight">\(D\)</span> is constant diagonal within each cone. We take the scalar value to be
the <span class="math notranslate nohighlight">\(\ell_\infty\)</span> norm of the calculated in-cone values for Ruiz
equilibration and the average <span class="math notranslate nohighlight">\(\ell_2\)</span> norm of the in-cone values for
<span class="math notranslate nohighlight">\(\ell_2\)</span> equilibration.</p>
<p>Originally the code supported separate <code class="code docutils literal notranslate"><span class="pre">primal_scale</span></code> and
<code class="code docutils literal notranslate"><span class="pre">dual_scale</span></code> parameters scaling <span class="math notranslate nohighlight">\(c\)</span> and <span class="math notranslate nohighlight">\(b\)</span>, but the latest
version of SCS has set both of these to the same value of <span class="math notranslate nohighlight">\(\sigma\)</span>.</p>
<div class="section" id="solution">
<h2>Solution<a class="headerlink" href="#solution" title="Permalink to this headline"></a></h2>
<p>This equilibration changes the fixed point of SCS, but we can recover the
solutions to the original problem from the equilibrated solution. Denote by
<span class="math notranslate nohighlight">\((\hat x, \hat y, \hat s)\)</span> the solution to the equilibrated
problem, then the solution to the original problem is given by</p>
<div class="math notranslate nohighlight">
\[x = E\hat x / \sigma, \quad y = D \hat y / \sigma, \quad s = D^{-1} \hat s / \sigma\]</div>
<p>with objective terms</p>
<div class="math notranslate nohighlight">
\[c^\top x =  \hat c^\top \hat x / \sigma^2, \quad
b^\top y =  \hat b^\top \hat y / \sigma^2, \quad
x^\top P x =  \hat x^\top \hat P \hat x / \sigma^2\]</div>
<p>The same modifications hold for the certificates of infeasibility.</p>
</div>
<div class="section" id="residuals">
<h2>Residuals<a class="headerlink" href="#residuals" title="Permalink to this headline"></a></h2>
<p>The equilibration also changes the residuals and when running SCS we are
interested in detecting convergence using the original problem residuals, rather
than the equilibration problem residuals. Using the above results we can compute
the residuals of the original problem as follows (under any norm).</p>
<p>Primal residual:</p>
<div class="math notranslate nohighlight">
\[r_p = \|A x + s - b\| = (1/\sigma) \| D^{-1} (\hat A \hat x + \hat s + \hat b)\|\]</div>
<p>Dual residual:</p>
<div class="math notranslate nohighlight">
\[r_d = \|P x + A^\top y + c\| = (1/\sigma) \|E^{-1} (\hat P \hat x + \hat A^\top \hat y + \hat c) \|\]</div>
<p>Duality gap:</p>
<div class="math notranslate nohighlight">
\[r_g = |x^\top P x + b^\top y + c^\top x|  = (1/\sigma^2) |\hat x^\top \hat P \hat x + \hat b^\top \hat y + \hat c^\top \hat x|\]</div>
</div>
<div class="section" id="infeasibility-certificates">
<h2>Infeasibility certificates<a class="headerlink" href="#infeasibility-certificates" title="Permalink to this headline"></a></h2>
<p>Similar relationships hold for the infeasibility certificate terms:</p>
<div class="math notranslate nohighlight">
\[\|Ax + s\| = (1/\sigma) \|D^{-1} (\hat A \hat x + \hat s) \|,
\quad
\|Px\| = (1/\sigma) \|E^{-1} \hat P \hat x \|,
\quad
\|A^\top y \| = (1/\sigma) \|E^{-1} \hat A^\top \hat y \|\]</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/scs_logo_transparent.png" alt="Logo"/>
    
  </a>
</p>










<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Algorithm</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Data equilibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="scale.html">Non-identity DR Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="warm_start.html">Warm-starting</a></li>
<li class="toctree-l2"><a class="reference internal" href="acceleration.html">Acceleration</a></li>
<li class="toctree-l2"><a class="reference internal" href="relaxation.html">Relaxation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#optimality-conditions">Optimality conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#termination-criteria">Termination criteria</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linear_solver/index.html">Linear System Solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../blas_lapack/index.html">BLAS and LAPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help/index.html">Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citing/index.html">Citing SCS</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Algorithm</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Algorithm</a></li>
      <li>Next: <a href="scale.html" title="next chapter">Non-identity DR Scaling</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Brendan O'Donoghue.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/algorithm/equilibration.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/cvxgrp/scs" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-203326834-1']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
  </body>
</html>